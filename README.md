# Лабораторная работа №7

## Тема: "***<u>Асинхронное программирование</u>***"

### Цель:

- Знакомство с асинхронным программированием;
- Получение практических навыков в параллельной обработке данных;
- Получение практических навыков в синхронизации потоков;

### Порядок выполнения работы:

- Ознакомиться с теоретическим материалом

- Реализовать задание в соответствии с вариантом (Вариант 18, ЛР №6)

- Отчитаться по выполненной работе путём демонстрации работающей программы на тестовых наборах данных (как подготовленных самостоятельно, так и предложенных преподавателем) и ответов на вопросы преподавателя (как из числа контрольных, так и по реализации программы).

### Требования к программе:

Модифицируйте вашу лабораторную работу №6 следующим образом:

- Должно быть реализовано три потока:
  
  - Поток, который осуществляет передвижение NPC на определенное расстояние (см. таблицу), а также определяет, что два NPC находятся на расстоянии убийства (см. таблицу). Если два NPC вступили в «бой», то он создает задачу для потока, осуществляющего бои.
  
  - Поток, который осуществляет бои. Если один npc может убивать другой, то каждый npc «кидает 6-гранный кубик» определяя силу атаки и силу защиты (соответственно). Если сила атаки больше, чем сила защиты – то происходит убийство.
  
  - Мертвые npc не передвигаются (у нас тут без некромантов).
  
  - Живые npc не могут покинуть карту (размер задается через константы, например 100 x 100)
  
  - Основной поток раз в секунду печатает карту. Мертвые npc на карте не отображаются.

- Осуществить контроль доступа к разделяемым ресурсов с помощью std::shared_lock и std::lock_guard

- Осуществить контроль к потоку вывода std::cout через std::lock_guard

- Потоки могут запускаться как std::thread с использованием лямбда функций или функторов (классов с перегруженным оператором operator())

- Вначале игры должно создаваться 50 npc в случайных локациях.

- Игра должна останавливаться через 30 секунд и выводить на экран список выживших

## Условие задачи:

| Кто нагоняет | Расстояние хода | Расстояние убийства |
|:------------:|:---------------:|:-------------------:|
| рыцарь       | 30              | 10                  |
| белка        | 5               | 5                   |
| пегас        | 30              | 10                  |

---

## Структура проекта

```
c:\MY_DIRECTORY\STUDING_MAI\3_sem\OOP_labs\OOP_7_lab\7_lab\
├── CMakeLists.txt
├── main.cpp
├── README.md
│
├── include/
│ ├── npc.h
│ ├── knight.h
│ ├── squirrel.h
│ ├── pegasus.h
│ ├── factory.h
│ ├── arena.h
│ ├── visitor.h
│ ├── combat_visitor.h
│ ├── observer.h
│ ├── console_observer.h
│ └── file_observer.h
│
├── src/
│ ├── npc.cpp
│ ├── knight.cpp
│ ├── squirrel.cpp
│ ├── pegasus.cpp
│ ├── factory.cpp
│ ├── arena.cpp
│ └── combat_visitor.cpp
│
└── tests/
    ├── gtests.cpp
    └── test_data_npcs.txt
```

## Сборка и запуск проекта

**Сборка:**

```bash
mkdir build
cd build

# Конфигурация проекта
cmake ..

# Сборка
cmake --build .

```

**Запуск программы:**

```bash
# Из директории build/
./7_lab_exe
```

**Запуск тестов:**

```bash
# Из директории build/

# Запуск всех тестов через CTest
ctest --verbose

# Или прямой запуск исполняемого файла тестов
./7_lab_gtests
```
